#!/bin/bash

######################################################################################################################
# Script for development use - removes any remaining files and package from site-packages
# Ensures clean installs for testing
# Rarely needed. Some rare install cases may leave remnants or test packages under site-packages
######################################################################################################################

# Set python package name
readonly PACKAGE="cmatools"

# Ask user if they want to continue?
echo ""
echo "Run from an active conda environment"
echo ""
read -p "This script will remove any files and directories relating to the package from site-packages. \
Continue? (Y/y to continue)" -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    exit 1
else
  echo ":"
fi

SITE_PACKAGES=$(python -c 'from distutils.sysconfig import get_python_lib; \
print(get_python_lib())')

# Verify site packages location
echo "Site package location: ${SITE_PACKAGES}"

if [ -d "${SITE_PACKAGES}/${PACKAGE}" ]
then
    echo ""
    echo "Package files exist at: ${SITE_PACKAGES}/${PACKAGE}"
    read -p "Remove files? (Y/y to continue)" -n 1 -r response
    echo ""
    if [[ "${response}" =~ ^[Yy]$ ]]
    then
      echo "Removing package files"
      rm -rf "${SITE_PACKAGES}/${PACKAGE}"
    else
      echo "Exiting"
      exit 1
    fi
    echo ""
else
    echo "Error: ${SITE_PACKAGES}/${PACKAGE} does not exist."
fi